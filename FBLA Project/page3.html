<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Found: Missing Item</title>
    <style>
        body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; max-width: 720px; margin: 2rem auto; padding: 0 1rem; color: #111; }
        header { display:flex; justify-content:space-between; align-items:center; gap:1rem; margin-bottom:1.5rem; }
        h1 { font-size:1.25rem; margin:0; }
        .card { border:1px solid #e3e3e3; padding:1rem; border-radius:8px; background:#fafafa; }
        .label { font-weight:600; color:#333; margin-top:.5rem; }
        .empty { color:#c300ff; margin-top:1rem; }
        a.button { display:inline-block; padding:.45rem .75rem; background:#0366d6; color:#fff; text-decoration:none; border-radius:6px; }
        button, input[type="text"] { font:inherit; }
        .controls { margin-top:1rem; display:flex; gap:.5rem; flex-wrap:wrap; }
    </style>
</head>
<body>
    <header>
        <h1>Find Your Missing Item</h1>
        <nav>
            <!-- Link back to the main page's "find your missing item" tag/section -->
            <a class="button" href="Html Fbla project 2025.html">Back to main</a>
        </nav>
    </header>

    <main>
        <h2 style="margin-top: 2rem; margin-bottom: 1.5rem;">Browse All Lost Items</h2>
        <div id="itemsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;"></div>
    </main>

    <script>
        // Load and display items from localStorage
        function loadItems() {
            const container = document.getElementById('itemsContainer');
            const items = JSON.parse(localStorage.getItem('lostItems') || '[]');

            if (items.length === 0) {
                container.innerHTML = `
                    <div class="card" style="background: #fef3cd; border: 1px solid #ffc107; color: #856404; grid-column: 1/-1;">
                        <strong>No lost items yet.</strong> Submit a report on the <a href="page2.html" style="color: #0366d6;">File Missing Item</a> page.
                    </div>
                `;
                return;
            }

            // Sort by date posted (newest first)
            items.sort((a, b) => new Date(b.datePosted) - new Date(a.datePosted));

            container.innerHTML = items.map((item, index) => `
                <div class="card" style="background: #fff; border: 2px solid #0366d6;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <h3 style="margin: 0 0 0.5rem 0; color: #0366d6;">${escapeHtml(item.item_name)}</h3>
                        <span style="background: #0366d6; color: #fff; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">${escapeHtml(item.category)}</span>
                    </div>
                    
                    <div class="label" style="margin-top: 0.75rem;">Description:</div>
                    <div style="color: #333; line-height: 1.5;">${escapeHtml(item.description)}</div>
                    
                    <div class="label">Last Known Location:</div>
                    <div style="color: #666;">${escapeHtml(item.location)}</div>
                    
                    <div class="label">Date Lost:</div>
                    <div style="color: #666;">${escapeHtml(item.date_lost)}</div>
                    
                    <div style="background: #f0f0f0; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
                        <div class="label" style="margin-top: 0;">Report Found:</div>
                        <div>If you found this item, contact:</div>
                        <div style="margin-top: 0.5rem; font-weight: bold;">${escapeHtml(item.name)}</div>
                        <div><a href="mailto:${escapeHtml(item.email)}" style="color: #0366d6; text-decoration: none;">${escapeHtml(item.email)}</a></div>
                    </div>
                    
                    <div style="color: #999; font-size: 0.85rem; margin-top: 0.75rem;">Posted: ${escapeHtml(item.datePosted)}</div>
                    <button onclick="viewItem(${index})" style="margin-top: 1rem; padding: 0.5rem 1rem; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Coordinate Pickup</button>
                </div>
            `).join('');
        }

        // When a user wants to coordinate pickup, save the selected item and go to page4
        function viewItem(index) {
            const items = JSON.parse(localStorage.getItem('lostItems') || '[]');
            const selected = items[index] || null;
            if (!selected) {
                alert('Item not found');
                return;
            }
            // store selected item for page4 to read
            localStorage.setItem('selectedItem', JSON.stringify(selected));
            // navigate to page4 where pickup coordination can occur
            window.location.href = 'page4.html';
        }

        function escapeHtml(s) {
            return String(s).replace(/[&<>"']/g, function(m) { return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]; });
        }

        // Load items when page loads
        document.addEventListener('DOMContentLoaded', loadItems);
    </script>

</body>
</html>